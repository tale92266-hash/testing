<!-- views/project.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title><%= project.name %> - DeployHub</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        margin: 0; padding: 0;
        color: #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    header {
        width: 100%;
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255,255,255,0.2);
        padding: 1rem 2rem;
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 1rem;
        color: white;
    }
    header a {
        color: white;
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    header a:hover {
        color: #74b9ff;
    }
    main {
        max-width: 900px;
        width: 100%;
        padding: 2rem;
        box-sizing: border-box;
    }
    h1 {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 2.2rem;
        margin-bottom: 1rem;
        color: white;
    }
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    .status-live {
        background: linear-gradient(45deg, #00b894, #00a085);
        color: white;
        box-shadow: 0 2px 10px rgba(0, 184, 148, 0.4);
    }
    .status-pending {
        background: linear-gradient(45deg, #74b9ff, #0984e3);
        color: white;
    }
    .status-building {
        background: linear-gradient(45deg, #fdcb6e, #e17055);
        color: white;
        animation: pulse 2s infinite;
    }
    .status-error {
        background: linear-gradient(45deg, #e17055, #d63031);
        color: white;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    .project-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        margin-bottom: 2rem;
        color: rgba(255, 255, 255, 0.9);
    }
    .meta-item {
        min-width: 200px;
    }
    .meta-label {
        font-weight: 600;
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
        opacity: 0.8;
    }
    .meta-value a {
        color: #74b9ff;
        text-decoration: none;
        word-break: break-word;
        user-select: text;
    }
    .actions-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        color: white;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    .btn-success { background: linear-gradient(45deg, #00b894, #00a085); }
    .btn-primary { background: linear-gradient(45deg, #74b9ff, #0984e3); }
    .btn-danger { background: linear-gradient(45deg, #e17055, #d63031); }
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    .logs-section {
        background: rgba(0, 0, 0, 0.85);
        border-radius: 15px;
        padding: 1rem;
        font-family: 'Consolas', 'Monaco', monospace;
        font-size: 0.88rem;
        line-height: 1.3;
        color: #00ff00;
        max-height: 450px;
        overflow-y: auto;
        white-space: pre-wrap;
        border: 1px solid #014d22;
        box-shadow: 0 0 20px #00ff00aa;
    }
    .refresh-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 10px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-weight: 600;
    }
    .refresh-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    @media (max-width: 600px) {
        main {
            padding: 1rem;
        }
        .project-meta {
            flex-direction: column;
        }
    }
</style>
</head>
<body>
<header>
    <a href="/" title="Back to Dashboard">
        <i class="fas fa-arrow-left"></i> Back
    </a>
</header>
<main>
    <h1>
        <i class="fas fa-cube"></i> <%= project.name %>
        <span class="status-badge status-<%= project.status.toLowerCase() %>">
            <% if (project.status === 'LIVE') { %>
                <i class="fas fa-circle"></i>
            <% } else if (project.status === 'Building' || project.status === 'Pending') { %>
                <i class="fas fa-spinner fa-spin"></i>
            <% } else if (project.status === 'Error') { %>
                <i class="fas fa-exclamation-triangle"></i>
            <% } %>
            <%= project.status %>
        </span>
    </h1>

    <div class="project-meta">
        <div class="meta-item">
            <div class="meta-label"><i class="fab fa-github"></i> Repository</div>
            <div class="meta-value">
                <a href="<%= project.repoUrl %>" target="_blank" rel="noopener"><%= project.repoUrl %></a>
            </div>
        </div>
        <% if (project.port) { %>
        <div class="meta-item">
            <div class="meta-label"><i class="fas fa-network-wired"></i> Port</div>
            <div class="meta-value"><%= project.port %></div>
        </div>
        <% } %>
        <div class="meta-item">
            <div class="meta-label"><i class="fas fa-hammer"></i> Build Command</div>
            <div class="meta-value"><%= project.buildCommand %></div>
        </div>
        <div class="meta-item">
            <div class="meta-label"><i class="fas fa-play"></i> Start Command</div>
            <div class="meta-value"><%= project.startCommand %></div>
        </div>
    </div>

    <div class="actions-bar">
        <% if (project.status === 'LIVE' && project.url) { %>
            <a href="<%= project.url %>" target="_blank" rel="noopener" class="btn btn-success">
                <i class="fas fa-external-link-alt"></i> Open Application
            </a>
        <% } %>
        <button onclick="location.reload()" class="btn btn-primary">
            <i class="fas fa-sync-alt"></i> Refresh Status
        </button>
        <form method="POST" action="/delete-project" onsubmit="return confirm('Are you sure you want to delete this project?');">
            <input type="hidden" name="projectName" value="<%= project.name %>">
            <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash"></i> Delete Project
            </button>
        </form>
    </div>

    <div class="logs-section" id="logsContainer" aria-live="polite" aria-atomic="true" role="log"></div>
</main>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    const projectName = '<%= project.name %>';
    const logsContainer = document.getElementById('logsContainer');

    socket.emit('joinProjectRoom', projectName);

    socket.on('logUpdate', (logMessage) => {
        logsContainer.textContent += logMessage;
        logsContainer.scrollTop = logsContainer.scrollHeight;
    });

    // Optional: Auto-refresh status badge with socket event if needed
    socket.on('statusUpdate', (status) => {
        // Can update status badge dynamically if implemented
    });

    // Scroll logs to bottom on load
    logsContainer.scrollTop = logsContainer.scrollHeight;
</script>
</body>
</html>
